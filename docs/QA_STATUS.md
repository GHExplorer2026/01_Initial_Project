# QA_STATUS.md

## Current Branch
- Branch: `main` (post `v0.1.6` release)
- Baseline: synced with `origin/main`

## Latest Deterministic Gate Run
- Command:
  - `npm run verify:release`
- Result:
  - `unit`: pass
  - `snapshot`: pass
  - `lint`: pass
  - `typecheck`: pass
  - `build`: pass
  - Current passing tests: `115`
- Environment:
  - Node `v20.20.0`
  - npm `10.8.2`

## Test Coverage Focus (SPEC-critical)
- Strict DE output formatting (headers, notes, TOP suffix)
- Source priority and tertiary trigger behavior
- Scope contract (`regions` primary, `countries` deprecated alias)
- Exact-time-only normalization and A-F classification
- Merge/dedupe/grouping determinism
- ICS RFC profile (CRLF, folding, VTIMEZONE, deterministic UID/DTSTAMP, category in every VEVENT)
- API contract behavior for `/api/weekly` and `/api/weekly.ics`

## Notes
- CI workflows run explicit `unit` and `snapshot` gates.
- CI uploads JUnit artifacts for `unit` and `snapshot` runs (`artifacts/vitest-*.xml`).
- Troubleshooting for CI test artifacts is documented in `docs/TROUBLESHOOTING.md`.
- Local consolidated check is available via `npm run verify`.
- Local verification requires Node `>=20.9.0`; CI remains source of truth when local runner is below baseline.
- `next build` generated updates were committed (`tsconfig.json`, `next-env.d.ts`) to keep repository and build output aligned.
- Additional SPEC edge-case tests were added for:
  - weekend week-window resolution in orchestrator
  - empty `regions` parameter with deprecated `countries` alias fallback
- Release finalized on `main` with tag `v0.1.0`; `origin/fix/source-mode-meta` was deleted after merge.
- Release finalized on `main` with tag `v0.1.1`.
- Final release-gate evidence:
  - `run_id=22035048334`
  - `status=success`
  - `install=success`, `verify=success`, `smoke=success`
- Next phase started:
  - `v0.1.5` planning initialized with scope/risk/task baseline.
  - `docs/V0_1_5_PLAN.md`
  - `docs/V0_1_5_RELEASE_DRAFT.md`
  - `docs/V0_1_5_EVIDENCE.md`
- `v0.1.5` baseline and adapter hardening progress:
  - `V-501` completed (`verify:release` + marker validation)
  - `V-502` completed (live fetch timeout handling + TradingView epoch timestamp parsing tests)
  - `V-503` completed (source timeout utility and adapter regression coverage expansion)
  - `V-504` completed (release-gate marker diagnostics now include run/step/smoke-tail details)
  - `V-505` completed (release marker validated + release docs finalized + tag published)
- Final release-gate evidence for `v0.1.5`:
  - `run_id=22035467485`
  - `status=success`
  - `install=success`, `verify=success`, `smoke=success`
- Release finalized on `main` with tag `v0.1.5`.
- Next phase started:
  - `v0.1.6` planning initialized with scope/risk/task baseline.
  - `docs/V0_1_6_PLAN.md`
  - `docs/V0_1_6_RELEASE_DRAFT.md`
  - `docs/V0_1_6_EVIDENCE.md`
- `v0.1.6` progress:
  - `V-601` completed (`verify:release` + marker validation, `run_id=22035703265`)
  - `V-602` completed (canonical fallback note-line contract hardening in tests)
  - `V-603` completed (release-gate marker mismatch runbook hardening)
  - `V-604` completed (full deterministic gate rerun, `115/115` tests)
  - `V-605` completed (release marker validated + release docs finalized + tag published)
- Post-release tooling hardening:
  - `next-env.d.ts` drift guard added (`npm run check:next-env`, `npm run fix:next-env`)
  - optional git hook setup via `npm run setup:hooks`
  - CI gates now enforce canonical `next-env.d.ts` import path
- Final release-gate evidence for `v0.1.6`:
  - `run_id=22035813418`
  - `status=success`
  - `install=success`, `verify=success`, `smoke=success`
- Release finalized on `main` with tag `v0.1.6`.
- `v0.1.2` UI implementation baseline added:
  - deterministic scope-state helpers in `src/app/scopeState.ts`
  - UI state/strict-output isolation refactor in `src/app/page.tsx`
  - helper tests in `tests/scopeState.ui.test.ts`
  - markup contract tests in `tests/page.ui.contract.test.ts`
  - deterministic endpoint helper tests in `tests/uiRequests.test.ts`
- `v0.1.2` release preparation docs initialized:
  - `docs/V0_1_2_RELEASE_DRAFT.md`
  - `docs/V0_1_2_EVIDENCE.md`
- Node-20 verify proof for current UI scope:
  - `TMPDIR=/tmp PATH="$HOME/.nvm/versions/node/v20.20.0/bin:$PATH" npm run verify:release`
  - result: pass (`111/111` tests, lint/typecheck/build green)
- Default shell (`node 18`) still hits Vitest ESM startup issues; use Node `>=20.9.0` path override (plus `TMPDIR=/tmp`) or CI for full suite runs.
- Latest release-gate marker is green and synced for current release-doc commit:
  - `run_id=22035048334`
  - `status=success`
  - `install=success`, `verify=success`, `smoke=success`
- Release finalized on `main` with tag `v0.1.3`.
- Release finalized on `main` with tag `v0.1.4`.
- `next-env.d.ts` drift handling is documented in `docs/TROUBLESHOOTING.md`.
